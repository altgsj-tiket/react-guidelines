(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{n3HD:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return l})),n.d(t,"default",(function(){return p}));var o=n("Fcif"),a=n("+I+c"),s=n("mXGw"),r=n("/FXl"),i=n("TjRS"),c=n("ZFoC"),l=(n("aD51"),{});void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/articles/testing/1-intro/1-intro.mdx"}});var u={_frontmatter:l},b=i.a;function p(e){var t,n,p=e.components,h=Object(a.a)(e,["components"]);return Object(r.b)(b,Object(o.a)({},u,h,{components:p,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"why-do-you-test"},"Why do you test?"),Object(r.b)("h3",{id:"for-the-peace-of-mind"},"For the Peace of Mind"),Object(r.b)("p",null,"That's it, that's why we test. Everything else boils down to this. We write Test to our code so we don't get waken up at 3 a.m. with dire news about something breaking somewhere critical. This is as far as I'll go. If you ",Object(r.b)("em",{parentName:"p"},"DO")," need to be convinced about why Unit Tests are good, ",Object(r.b)("a",{parentName:"p",href:"https://www.google.com/search?q=why+unit+testing+is+important&oq=why+unit+testing+is+important&aqs=chrome..69i57j0i19i22i30l3.498j0j4&sourceid=chrome&ie=UTF-8"},"get out of that cave now by clicking here"),"."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"IMPORTANT"),": If you test just to show off how many layers of abstraction you're able to handle to manage a jungle of loosely tied tests, ",Object(r.b)("a",{parentName:"p",href:"https://chromatichq.com/blog/principles-testdriven-development"},"please stop right now"),".")),Object(r.b)("p",null,"Once we're past that, let me ask you a simple question"),Object(r.b)("h2",{id:"has-your-testing-got-you-any-peace-of-mind-recently"},"Has your testing got you any Peace of Mind, recently?"),Object(r.b)("p",null,"Most React testing I've seen done in the wild isn't even close to beeing enough to ensure the much desired peace of mind we all are looking for. To achieve it, we need to have 100% code coverage for what matters, and be able to rest assured that every single piece of the testing code is properly written. And if that's hard enough said, it's way worse when you actually try to do it."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"As a quick rule of thumb, TDD isn't supposed to make you suffer. If you're having to increase the complexity of your code so it can be testable and it's still not thoroughly tested, then what's the point of testing in the first place. Testing was supposed to bring us happiness, not to suck every bit of energy out of our bodies...")),Object(r.b)("h3",{id:"quick-example"},"Quick example"),Object(r.b)("p",null,"Let's resort to the classic case of a Counter, as written below."),Object(r.b)(c.b,{__position:0,__code:"() => {\n  const [counter, setCounter] = useState(0)\n  const increase = () => setCounter(counter => counter + 1)\n  const decrease = () => setCounter(counter => counter - 1)\n  return (\n    <div>\n      <button onClick={decrease}>-</button>\n      <span>{counter}</span>\n      <button onClick={increase}>+</button>\n    </div>\n  )\n}",__scope:(t={props:h,DefaultLayout:i.a,useState:s.useState,Playground:c.b},t.DefaultLayout=i.a,t._frontmatter=l,t),mdxType:"Playground"},(function(){var e=Object(s.useState)(0),t=e[0],n=e[1];return Object(r.b)("div",null,Object(r.b)("button",{onClick:function(){return n((function(e){return e-1}))}},"-"),Object(r.b)("span",null,t),Object(r.b)("button",{onClick:function(){return n((function(e){return e+1}))}},"+"))})),Object(r.b)("p",null,"Now, how are we supposed to test this component? If you follow almost every single tutorial on the internet, you may be readying yourself to start adding ",Object(r.b)("inlineCode",{parentName:"p"},"data-test-id")," props everywhere, just so we can reference the rendered elements to simulate clicks or check their content..."),Object(r.b)(c.b,{__position:1,__code:'() => {\n  const [counter, setCounter] = useState(0)\n  const increase = () => setCounter(counter => counter + 1)\n  const decrease = () => setCounter(counter => counter - 1)\n  return (\n    <div>\n      <button data-test-id="decrement" onClick={decrease}>\n        -\n      </button>\n      <span data-test-id="result">{counter}</span>\n      <button data-test-id="increment" onClick={increase}>\n        +\n      </button>\n    </div>\n  )\n}',__scope:(n={props:h,DefaultLayout:i.a,useState:s.useState,Playground:c.b},n.DefaultLayout=i.a,n._frontmatter=l,n),mdxType:"Playground"},(function(){var e=Object(s.useState)(0),t=e[0],n=e[1];return Object(r.b)("div",null,Object(r.b)("button",{"data-test-id":"decrement",onClick:function(){return n((function(e){return e-1}))}},"-"),Object(r.b)("span",{"data-test-id":"result"},t),Object(r.b)("button",{"data-test-id":"increment",onClick:function(){return n((function(e){return e+1}))}},"+"))})),Object(r.b)("p",null,"Then the testing code could be something like the code below"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-typescript"},'import React from "react";\nimport {\n  fireEvent,\n  render,\n  screen,\n  getAllByTestId,\n} from "@testing-library/react";\n\nimport Counter from "./Counter";\n\ndescribe("Component: Counter", () => {\n  it("Works properly", () => {\n    render(<Counter />);\n\n    const decrease = getAllByTestId("decrease");\n    const increase = getAllByTestId("increase");\n    const result = getAllByTestId("result");\n\n    fireEvent.click(increase);\n\n    expect(result.innerHTML).toEqual("1");\n\n    fireEvent.click(decrease);\n\n    expect(result.innerHTML).toEqual("0");\n  });\n});\n')),Object(r.b)("p",null,"Althought such a simple component wouldn't be that hard to test, notice how we need, just for achieving the simplest of the checks, to instrument the code. Those pesky ",Object(r.b)("em",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"em"},"data-test-id"))," serve no purpose other than making tests possible. But the very concept of having to somehow modify the code so we can test it contradicts one of the basic principles of TDD: ",Object(r.b)("em",{parentName:"p"},"Tested code shouldn't care how it's gonna be tested"),". That's precisely what's happening here, or else the test wouldn't be possible."),Object(r.b)("p",null,"As if it's not crazy enough that we need to actually render a component to check if a simple function execution behaves properly, I must remind you that the change is not always as straigtforward to test as a string inside an arbitrary container. Many times the effect of changing a prop is as subtle as an animation. Soon enough we end up having to write tests for checking for css class names and for the presence of css styles. Then someone changes a color, or the name of a prop in a component and then the project gets littered with small, unrelated changes to prevent a ton of falsely failing tests (false negatives). Or even worse: Some functionality stops working, but the assertion was too wide and now we get a falsely successful test (false positives)."),Object(r.b)("p",null,"If we are to be testing in such a fragile environment, then why are we bothering to test at all? Testing is just creating more places for code to break. We test to achieve peace of mind, but writing tests with React has traditionally led to anything but it."),Object(r.b)("p",null,"The problem is that we've mostly stopped testing JS function execution and started testing solely React Components. Testing JS code is easy, but testing React Components and all of its intricacies is pretty hard. Worse: very few projects and teams have both available manpower and the skillset needed to write a complete set of Component Tests. Furthermore, ",Object(r.b)("strong",{parentName:"p"},"let me dare to say")," that ",Object(r.b)("strong",{parentName:"p"},"most teams")," and projects ",Object(r.b)("strong",{parentName:"p"},"DO NOT NEED")," a complete set of Component tests."),Object(r.b)("p",null,"Are you provoked yet? Bear with me a little longer..."),Object(r.b)("h2",{id:"stop-testing-react"},"Stop testing React"),Object(r.b)("p",null,"The spirit of TDD is ",Object(r.b)("strong",{parentName:"p"},"TESTING THE FUNCTIONALITY"),", not necessarily testing every single line of written code. Not all the code needs to be tested so you can achieve peace of mind."),Object(r.b)("p",null,"Take a minute take a good look at the example above. Notice that whenever we assert the internal state of an element to check for proper interaction hebavior (like we do with ",Object(r.b)("inlineCode",{parentName:"p"},'expect(result.innerHTML).toEqual("1")'),") we're not only testing for the expected behavior, but also testing if React is actually doing what it's supposed to do and putting the value in the expected location. Do we really need to be spending time to test if React is being ",Object(r.b)("em",{parentName:"p"},"Reacty"),"? React already has ",Object(r.b)("a",{parentName:"p",href:"https://circleci.com/gh/facebook/react"},"it's own tests")),Object(r.b)("h3",{id:"dont-try-to-automate-what-cant-be-automated"},"Don't try to automate what can't be automated"),Object(r.b)("p",null,"Checking a button's color or if it's correctly wired to a callback is something that will have to go through human testing anyway. We should be way more worried about asserting function execution results than trying to assert correctness through loosely inspecting the rendered result."),Object(r.b)("p",null,"Because let's face it: JSX is declarative and pretty straightforward, not much that can go wrong there that the IDE or the linter won't warn you. Even in the worst case scenario, a callback that isn't properly wired will be pretty obvious when we click something that doesn't work, and that's just part of the normal development testing cycle. Now, most of the real problems we end up facing are related to the hooks at the top, where we actualy weave together the fabric of the interactions between each and every component."),Object(r.b)("h2",{id:"hooks-to-the-rescue"},"Hooks to The Rescue"),Object(r.b)("p",null,"Now Hooks are just plain functions, and therefore super easy to test. ",Object(r.b)("strong",{parentName:"p"},"The very reason for the existance of Hooks")," is to enable us to ",Object(r.b)("em",{parentName:"p"},'"',Object(r.b)("a",{parentName:"em",href:"https://reactjs.org/docs/hooks-intro.html#its-hard-to-reuse-stateful-logic-between-components"},"extract stateful logic from a component so it can be tested independently and reused"),'"'),", effectively decoupling UI rendering from business logic while ",Object(r.b)("a",{parentName:"p",href:"https://mostly-adequate.gitbook.io/mostly-adequate-guide/"},"mostly adhering to the functional paradigm"),"."),Object(r.b)("h2",{id:"strategy-overview"},"Strategy overview"),Object(r.b)("p",null,"So the overview of the strategy is pretty simple:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"/react-guidelines/testing/pfcs-for-ui-sanity"},"Write pure functional components for UI sanity")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"/react-guidelines/testing/parallel-ui-qa-with-storybook"},"Move plain UI testing to Storybook")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"/react-guidelines/testing/separating-concerns-with-hooks"},"Separate the concerns by using hooks")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("a",{parentName:"li",href:"/react-guidelines/testing/testing-hooks"},"Unit Testing interactions")),Object(r.b)("li",{parentName:"ol"},"Then what's the ",Object(r.b)("inlineCode",{parentName:"li"},"react-testing-library")," good for?")),Object(r.b)("p",null,"Whatever happens, always remember: Tests are supposed to make our jobs more fun. If we experience anything but bliss, then we're probably doing it wrong, and there must be a better, more sane way."))}void 0!==p&&p&&p===Object(p)&&Object.isExtensible(p)&&!p.hasOwnProperty("__filemeta")&&Object.defineProperty(p,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/articles/testing/1-intro/1-intro.mdx"}}),p.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-articles-testing-1-intro-1-intro-mdx-04ff075edb5cd265925a.js.map